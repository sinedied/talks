<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>The revolution in your apps is called **State Management**</title>
  <link rel="stylesheet" href="style.css">
  <script src="remark.min.js"></script>
  <script>
    function create() {
      var slideshow = remark.create({
        source: "title: The revolution in your apps is called **State Management**\nclass: animation-fade\nlayout: true\n\n.twitter-handle[\n  @sinedied\n]\n\n---\n\nclass: center, middle, hide-handle\nbackground-image: url(images/bw.jpg)\n\n# .alt-text[The revolution in your apps is called<br>.big.light-text[**State Management**]]\n<br>\n\n.who-box.no-margin[\n  .row.table.middle.text-center[\n  .col-3.small.text-left.no-margin[\n  Yohan Lasorsa<br>\n  .fab.fa-github[] &nbsp;&nbsp;/sinedied<br>\n  .fab.fa-twitter[] @sinedied\n  ]\n  .col-6.small.half[\n  .w-90.no-margin[\n  .w-50.responsive[![](images/devfest-strasbourg.png)]\n  ]\n  ]\n  .col-3.small.text-right.no-margin[\n  .w-80.responsive[![](images/ms-full-logo.svg)]\n  ]\n  ]\n]\n\n<!-- .full-layer.who.text-right.small.middle[\n  .ms.responsive[![](images/ms-full-logo.svg)]\n  |\n  Yohan Lasorsa\n  |\n  @sinedied\n  <br><br>\n] -->\n\n---\n\nclass: middle, center, hide-handle\n# .large[Who am I?]\n\n.table.row.middle[\n.col-4.center[\n  .w-70.responsive.avatar.tada.animated[![](images/photo.jpg)]\n]\n.col-8.bit-larger.left[\n  .e[Yohan Lasorsa]<br>\n  .bit-larger[\\[ Cloud Developer Advocate .mini-img[![](images/ms.png)] \\]]<br>\n  .small.em-text[Web tech geek, OSS maintainer, DIY lover]<br>\n]\n]\n.center.bit-larger[\n.large.em-text[{]\n.fab.fa-twitter[] .fab.fa-github[] .fab.fa-dev[]\n.large.em-text[}] .e[@sinedied]<br>\n]\n\n???\n\nca fait plus de 10 ans que je baigne dans le monde du web...\nje ne vais pas vous refaire tout l'historique, car simplement...\n\n---\n\nclass: center, middle\n\n# Making web apps today\n\n.center[\n  .w-20.responsive[![](images/angular.svg)]\n  .w-20.responsive[![](images/react.svg)]\n  .w-20.responsive[![](images/vue.svg)]\n]\n\n???\nQui fait de l'Angular? React? Vue? Pas de web?\n\nUn peu de contexte:\n- 3 gros frameworks pour faire des appli web\n- je rentrerai pas dans les debats de religion ici, par qu'on s'en fout finalement aujourd'hui!\n\n--\n\n# .big[= **components**]\n\n???\n\n- nos app sont toutes orientées composants\n  * simple, de presentation, stateless\n  * complexe, containers, eventuellement stateful\n\n---\n\n.full-layer[\n.center[\n.w-60.responsive[![](images/component-tree-simple.png)]\n<br>\nComponent Tree\n]\n]\n\n???\n\nNos apps ne sont pas simple ou complexe par nature\n(du moins j'en ai encore jamais vu)\n\nElle demarrent toutes comme ca\n\n---\n\n.full-layer[\n.center[\n.w-60.responsive[![](images/component-tree.png)]\n<br>\nComponent Tree\n]\n]\n\n???\n\nEt finissent rapidement comme ca!\n\n---\n\n.full-layer[\n.center[\n.w-60.responsive[![](images/component-tree-linked.png)]\n<br>\nComponent Tree\n]\n]\n\n???\n\nDonnées liées: comment garantir qu'elle soient toujours à jour?\n\n---\n\nclass: big-text, middle\n\n# Challenges\n\n- Complexity\n- Debugging\n- Performance\n- Long-term maintenance\n- Documentation\n\n.full-layer.right.space-right[\n  .w-40[\n  .rounded.responsive[![](images/oops.jpg)]\n  ]\n]\n\n---\n\nclass: impact\n# .small[.animated.jackInTheBox.ib[{ State }] Management?]\n\n???\n\nMettons nos problèmes de cotés quelques instants...\n\n---\n\nclass: timeline\n\n.head[\n# .alt-text.fas.fa-history[]&nbsp; Where does it come from?\n]\n<div style=\"height: 3.3em\"></div>\n\n- #### 1988\n  - Command-Query Separation (CQS)\n- #### 1997\n  - Functional Reactive Programming (FRP)\n- #### 2012\n  - Elm\n- #### 2014\n  - Flux architecture (React)\n- #### .boom.responsive[![](images/boom.jpg)] **2015**\n  - **Redux, MobX, NGRX, VueX**\n- #### 2018\n  - NGXS, Akita, Unstated, React Context/Hooks\n\n???\n- RP (UI): User actions as a stream of events\n- Redux created by Dan Abramov when preparing a talk on hot reloading\n- Mobile: ReSwift, Reductor, Jedux\n\n---\n\nclass: middle, center, hide-handle\n\n.responsive.bounceInDown.animated.ib[![](images/redux-logo.png)]\n\n???\n- Why?\n  * Born from development needs: predicatability, time travel, debugging...\n  * Simple\n\nQui utilise Redux ici?\n\n---\n\nclass: hide-handle\n.head.dark[\n# .fit[![](images/redux-icon.svg)] The 3 principles\n]\n.head-spacer[]\n\n## Single source of truth\nThe **state** of your whole application is stored in an object tree within a single **store**.\n--\n\n## State is read-only\nThe only way to change the **state** is to emit an action, an object describing what happened.\n--\n\n## Changes are made with pure functions\nTo specify how the state tree is transformed by actions, you write pure **reducers**.\n\n---\n\nclass: center, hide-handle\n.head.dark[\n# .fit[![](images/redux-icon.svg)] Redux data flux\n]\n<br><br>\n.col-11.responsive[![](images/redux0.png)]\n\n---\n\nclass: center, hide-handle\n.head.dark[\n# .fit[![](images/redux-icon.svg)] Redux data flux\n]\n<br><br>\n.col-11.responsive[![](images/redux1.png)]\n\n---\n\nclass: center, hide-handle\n.head.dark[\n# .fit[![](images/redux-icon.svg)] Redux data flux\n]\n<br><br>\n.col-11.responsive[![](images/redux2.png)]\n\n---\n\nclass: center, hide-handle\n.head.dark[\n# .fit[![](images/redux-icon.svg)] Redux data flux\n]\n<br><br>\n.col-11.responsive[![](images/redux.png)]\n\n---\n\nclass: impact\n# .small[Let's make our<br>.animated.jello.ib[**own**] Redux]!\n\n---\n\nclass: big-text, medium-code\n\n.head[\n# .alt-text.fas.fa-code[]&nbsp; Actions\n]\n.head-spacer.min[]\n\n```js\nfunction loadContent() {\n  return { type: 'Load content' };\n}\n\nfunction updateContent(content) {\n  return {\n    type: 'Update content',\n    content\n  };\n}\n```\n???\n- Are object (in-place literals or action creators)\n- Define and intention\n- Have unique type\n- Can carry data (payload)\n\n---\n\nclass: big-text, medium-code\n\n.head[\n# .alt-text.fas.fa-code[]&nbsp; Actions\n]\n.head-spacer.min[]\n\n```js\nfunction loadContent() {\n* return { type: 'Load content' };\n}\n\nfunction updateContent(content) {\n* return {\n*   type: 'Update content',\n*   content\n* };\n}\n```\n???\n- Are object (in-place literals or action creators)\n- Define and intention\n- Have unique type\n- Can carry data (payload)\n\n---\n\nclass: big-text, medium-code\n\n.head[\n# .alt-text.fas.fa-code[]&nbsp; Reducer\n]\n.head-spacer.min[]\n\n\n```js\n\n\nfunction editorApp(previousState, action) {\n  switch(action.type) {\n\n\n\n\n\n\n    default:\n      return previousState;\n  }\n}\n```\n\n---\n\nclass: big-text, medium-code\n\n.head[\n# .alt-text.fas.fa-code[]&nbsp; Reducer\n]\n.head-spacer.min[]\n\n\n```js\n*const initialState = { content: 'Hello?' };\n\n*function editorApp(previousState = initialState, action) {\n  switch(action.type) {\n\n\n\n\n\n\n    default:\n      return previousState;\n  }\n}\n```\n\n---\n\nclass: big-text, medium-code\n\n.head[\n# .alt-text.fas.fa-code[]&nbsp; Reducer\n]\n.head-spacer.min[]\n\n\n```js\nconst initialState = { content: 'Hello?' };\n\nfunction editorApp(previousState = initialState, action) {\n  switch(action.type) {\n*   case 'Update content':\n*     return {\n*       ...previousState,\n*       content: action.content\n*     };\n    default:\n      return previousState;\n  }\n}\n```\n\n---\n\nclass: big-text, medium-code\n\n.head[\n# .alt-text.fas.fa-code[]&nbsp; Store\n]\n.head-spacer.none[]\n\n\n```js\nfunction createStore(reducer) {\n  let _state = reducer(undefined, { type: '@@INIT' });\n  let store = {};\n  return store;\n}\n```\n\n---\n\nclass: big-text, medium-code\n\n.head[\n# .alt-text.fas.fa-code[]&nbsp; Store\n]\n.head-spacer.none[]\n\n\n```js\nfunction createStore(reducer) {\n  let _state = reducer(undefined, { type: '@@INIT' });\n  let store = {\n*   getState: () => _state,\n  };\n  return store;\n}\n```\n\n---\n\nclass: big-text, medium-code\n\n.head[\n# .alt-text.fas.fa-code[]&nbsp; Store\n]\n.head-spacer.none[]\n\n\n```js\nfunction createStore(reducer) {\n  let _state = reducer(undefined, { type: '@@INIT' });\n* let _observer = null;\n  let store = {\n    getState: () => _state,\n*   subscribe: observer => {\n*     _observer = observer;\n*     if (_observer) _observer(_state);\n*   }\n  };\n  return store;\n}\n```\n\n---\n\nclass: big-text, medium-code\n\n.head[\n# .alt-text.fas.fa-code[]&nbsp; Store\n]\n.head-spacer.none[]\n\n```js\nfunction createStore(reducer) {\n  let _state = reducer(undefined, { type: '@@INIT' });\n  let _observer = null;\n  let store = {\n    getState: () => _state,\n    subscribe: observer => {\n      _observer = observer;\n      if (_observer) _observer(_state);\n    },\n*   dispatch: action => {\n*     _state = reducer(_state, action);\n*     if (_observer) _observer(_state);\n*   }\n  };\n  return store;\n}\n```\n\n---\n\nclass: big-text, medium-code\n\n.head[\n#  .alt-text.fas.fa-code[]&nbsp; Using it\n]\n.head-spacer.min[]\n\n\n```js\nconst store = createStore(editorApp);\n\nstore.subscribe(state => {\n  console.log(state.content);\n});\n\nstore.dispatch(updateContent('Hello DevFest!'));\n```\n> Result?\n\n--\n\n```sh\n> Hello?\n> Hello DevFest!\n```\n\n---\n\nclass: big-text, medium-code\n\n.head[\n#  .alt-text.fas.fa-code[]&nbsp; Side effects?\n]\n.head-spacer.min[]\n\n```js\nconst store = createStore(editorApp);\n\nstore.subscribe(state => {\n  console.log(state.content);\n});\n\n*store.dispatch(loadContent()); // Async call here?\nstore.dispatch(updateContent('Hello DevFest!'));\n```\n\n> How to manage?\n\n---\n\nclass: big-text, medium-code\n\n.head[\n# .alt-text.fas.fa-code[]&nbsp; Actions with thunks\n]\n.head-spacer.min[]\n\n```js\nfunction loadContent() {\n* return (dispatch) => {\n*   setTimeout(\n*     () => dispatch(updateContent('Hello async!')), 1000\n*   );\n* };\n}\n\nfunction updateContent(content) {\n  return {\n    type: 'Update content',\n    content\n  };\n}\n```\n???\nThunk: fct dont on retarde l'evaluation\n\n---\n\nclass: big-text, medium-code\n\n.head[\n# .alt-text.fas.fa-code[]&nbsp; Store\n]\n.head-spacer.none[]\n\n```js\nfunction createStore(reducer) {\n  let _state = reducer(undefined, { type: '@@INIT' });\n  let _observer = null;\n  let store = {\n    getState: () => _state,\n    subscribe: observer => { ... },\n    dispatch: action => {\n*     if (typeof action === 'function')\n*       return action(store.dispatch);\n      _state = reducer(_state, action);\n      if (_observer) _observer(_state);\n    }\n  };\n  return store;\n}\n```\n\n---\n\nclass: big-text, medium-code\n\n.head[\n#  .alt-text.fas.fa-code[]&nbsp; Side effects in action\n]\n.head-spacer.min[]\n\n```js\nconst store = createStore(editorApp);\n\nstore.subscribe(state => {\n  console.log(state.content);\n});\n\nstore.dispatch(loadContent());\nstore.dispatch(updateContent('Hello DevFest!'));\n```\n\n> Result?\n\n--\n\n```sh\n> Hello?\n> Hello DevFest!\n> Hello async!\n```\n\n---\n\nclass: center\n# Redux design pattern in the wild\n\n.row.table.center[\n.col-4[\n  .w-40.responsive[![](images/angular.svg)]\n  <br><br>\n  .large.fas.fa-arrow-down[]\n  <br>\n  ### @ngrx\n  .w-40.no-margin[\n  .w-90.responsive[![](images/ngrx.svg)]\n  ]\n]\n.col-4[\n  .w-40.responsive[![](images/react.svg)]\n  <br><br>\n  .large.fas.fa-arrow-down[]\n  <br>\n  ### Redux\n  .w-40.responsive[![](images/redux-icon.svg)]\n]\n.col-4[\n  .w-40.responsive[![](images/vue.svg)]\n  <br><br>\n  .large.fas.fa-arrow-down[]\n  <br>\n  ### VueX\n  .w-40.responsive[![](images/vuex.png)]\n]\n]\n\n---\n\nclass: center\n# Redux design pattern in the wild\n\n.row.table.center[\n.col-4[\n  .w-40.responsive[![](images/angular.svg)]\n  <br><br>\n  .large.fas.fa-arrow-down[]\n  <br>\n  ### NGXS\n  <br>\n  .w-60.responsive.animated.heartBeat[![](images/ngxs.png)]\n]\n.col-4[\n  .w-40.responsive[![](images/react.svg)]\n  <br><br>\n  .large.fas.fa-arrow-down[]\n  <br>\n  ### Redux\n  .w-40.responsive[![](images/redux-icon.svg)]\n]\n.col-4[\n  .w-40.responsive[![](images/vue.svg)]\n  <br><br>\n  .large.fas.fa-arrow-down[]\n  <br>\n  ### VueX\n  .w-40.responsive[![](images/vuex.png)]\n]\n]\n\n---\n\nclass: impact\n\n# .small[Do we .ib.animated.swing[**need**] it?]\n\n???\n\nOn a deja bcp de libs!\n\n- Non tant que le besoin ne s'est fait pas ressortir...\n\n---\n\nclass: dark, light-text, contain\nbackground-image: url(images/so-far.jpg)\n\n???\n... mais souvent c'est alors trop tard :(\n\n---\n\nclass: middle, no-bullet\n\n.col-6.right.space-right.large.v-sep.alt-sep.float-left[\n# .big.sketch[Gain]\n- Debugging\n- Undo history\n- No prop drilling\n- Performance (Angular)\n]\n???\nAlso RT collaboration\n\nGain évidents / fonctionnels:\n- time travel debug / bug reports / tracabilité\n- undo = 101 du state management\n- prop drilling > plutot React, transmission de state dans toute la hierarchie\n- perf ng > reactive mode w/o change detection\n--\n.col-6.space-left.large.float-left[\n# .big.sketch[Pain]\n- Boilerplate\n- More indirection levels\n- Learning curve\n]\n\n--\n\n.full-layer.left.space-left.stick-top.no-margin[\n  .w-20.responsive.rounded.slideInDown.animated[![](images/captain-obvious.png)]\n]\n\n???\n\nGain évidents / fonctionnels:\n- time travel debug / bug reports / tracabilité\n- undo = 101 du state management\n- prop drilling > plutot React, transmission de state dans toute la hierarchie\n- perf ng > reactive mode w/o change detection\n\n---\n\nclass: middle, no-bullet\n\n.full-layer.left.space-left.stick-top.no-margin[\n  # .dark-text.bit-larger.sketch[\\#realworld]\n]\n\n.col-6.right.space-right.large.v-sep.alt-sep.float-left[\n# .alt-text[More] .big.sketch[Gain]\n- Workflow\n- Testability & Evolutivity\n- Structure\n- Self-documentation\n]\n???\n=> @CRITEO\n- change how you design/think your features\n- TDD / backend within frontend\n- Structure: container/pres. components, where should I...\n- Clear intentions, discoverability\n--\n.col-6.space-left.large.float-left[\n# .alt-text[Less] .big.sketch[Pain]<sup>*</sup>\n- Boilerplate\n- .strike[More indirection levels]\n- Learning curve\n]\n\n.full-layer.stick-bottom.right.space-right[\n\\* than expected\n]\n\n???\n- more code, but simple\n- once setup/example is done, easy to catch\n\n---\n\nclass: impact\n.w-60.responsive.animated.shake[![](images/spoiler.png)]\n## .alt-text.large[New solution, new problems]\n\n---\n\nvideo: v1\n# Should I put it in the store?\n### (see also: state zealots)\n.center.rounded[\n<video id=\"v1\" width=\"70%\" src=\"images/shouldi.webm\"></video>\n]\n\n???\n\n- Store === git repository\n\n=> ne garder que ce qui est nécessaire pour reconstruire un état donné\n\n=> pas d'état intermédiaire \"instable\"\n\n- action === commit\n\n---\n\nvideo: v2\n# Side effects\n### (aka: I'll put it there, nobody will know)\n.center.rounded[\n<video id=\"v2\" width=\"70%\" src=\"images/sideeffects.webm\"></video>\n]\n\n???\n\n- charger 1 donnée depuis localstorage, call async dans un reducer, Date.now() dans un reducer...\n\n=> effet souvent pas immédiat, mais casse toute la chaine de promesse et tres dur a debug\n\n---\n\nvideo: v3\n# Chained actions\n### (aka: yay, a new event bus!)\n.center.rounded[\n<!-- .w-60.responsive.rounded[![](images/facepalm.jpg)] -->\n<video id=\"v3\" width=\"70%\" src=\"images/eventbus.webm\"></video>\n]\n\n???\n\n- Actions ont un effet sur l'etat\n=> dangereux de passer en mode event, car pas fait pour ca initialement\n\n- antipattern: action qui déclenche plusieurs actions (qui elle memes...)\n\n- store et actions ne servent pas faire du découpage fonctionnel!\n\n---\n\n# Overstorage in state\n### (aka: it's not free caching?)\n.center[\n.w-70.responsive.rounded[![](images/storage.jpg)]\n]\n\n???\n\n- On stocke tout, pour tous les écrans! meme les états dérivés!\n\n=> selecteurs avec memoization\n\n=> clean unused data\n\n---\n\nvideo: v4\n# Overengineering\n### (aka: let's make a wrapper for...)\n.center.rounded[\n<video id=\"v4\" width=\"70%\" src=\"images/overengineering.webm\"></video>\n]\n\n???\n\nSM, le nouveau joujou des devs!\n\nTout ne doit pas s'articuler autout hein...\nex: analytics\nex: helpers qui mergent/trigg de multiples actions (rxjs?)\n\n---\n\nclass: impact\n# .small[Conclusion]\n## .alt-text[(As always) not a silver bullet]\n.w-20.responsive.middle[![](images/silver-bullet.png)]\n\n???\nStill... use it whenever you can! Or at least think like it\n\n---\n\nclass: big-text, middle\n# .w-10.responsive.middle[![](images/gerrit.svg)] Challenges\n\n.baseline[\n- .w-50.ib[Complexity] .dminus[--]\n- .w-50.ib[Debugging] .dplus[++]\n- .w-50.ib[Performance] .dneutral[=] &nbsp;(Angular: .dplus[+])\n- .w-50.ib[Long-term maintenance] .dplus[++++]\n- .w-50.ib[Documentation] .dplus[+]\n]\n\n---\n\nclass: middle, hide-handle\n\n.big-text.no-bg.baseline[\n```js\nstore.dispatch(\n  new EndTalk({\n    message: 'Thank you!',\n    slides: 'bit.ly/sm-deck',\n    examples: 'github.com/sinedied/md-editor\n  })\n);\n```\n]\n<hr class=\"hr-right more-space\">\n.right.large[\n.large.em-text[{]\n.fab.fa-twitter[] .fab.fa-github[] .fab.fa-dev[]\n.large.em-text[}] .e[@sinedied]<br>\n]\n\n---\n\nexclude: true\n.head.dark[\n# Links\n]\n.head-spacer[]\n\n- [You might not need Redux](https://medium.com/@dan_abramov/you-might-not-need-redux-be46360cf367)\n- [NGXS website](https://ngxs.gitbook.io/ngxs/)\n- [Redux website](https://redux.js.org/)\n- [NGRX libs](https://github.com/ngrx/platform)\n- [What is VueX?](https://vuex.vuejs.org/)\n- [Markdown Editor variants](https://codesandbox.io/dashboard/sandboxes/Markdown%20Editor)\n\n<!-- \n\nTODO:\n- update PDF\n- fix example code!!\n -->\n",
        ratio: '16:9',
        highlightLines: true,
        countIncrementalSlides: false,
        highlightStyle: 'github'
      });
      slideshow.on('showSlide', function (slide) {
        var v = slide.properties.video;
        if (v) {
          var video = window[v];
          video = video.play ? video : video[0];
          video.currentTime = 0;
          video.play();
        }
      });
      return slideshow;
    }
  </script>
</head>
<body onload="slideshow = create()">
</body>
</html>